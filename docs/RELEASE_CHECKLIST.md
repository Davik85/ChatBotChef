# RELEASE_CHECKLIST.md — проверка перед релизом

Используйте этот чек-лист перед выкатыванием новой версии бота.

## Сборка и тесты

- [ ] `./gradlew clean test fatJar` успешно выполняется на CI/локально.
- [ ] Версия JRE на сервере ≥ 21 (`java -version`).

## Проверки на staging/локально

- [ ] Бот запускается (`java -jar ChatBotChef-all.jar`) и проходит health-check OpenAI (`OPENAI-HEALTH-ERR` отсутствуют).
- [ ] Проверена команда `/start`, все кнопки работают, админ-режим сбрасывается корректно.
- [ ] Лимит бесплатных сообщений (`FREE_TOTAL_MSG_LIMIT`) отрабатывает: после достижения 10 сообщений отправляется paywall.
- [ ] Напоминания о премиуме срабатывают (см. `premium_reminders` или тестовые значения `until_ts`).

## Платежи

- [ ] Создание инвойса (`/premium`) проходит, пользователь видит корректные сумму и описание.
- [ ] Выполнен тестовый платёж на минимальную сумму в sandbox/боевом режиме.
- [ ] При `NPD_MODE=true` чек не формируется, поля `provider_data.receipt` отсутствуют.
- [ ] При `RECEIPTS_ENABLED=true` чек содержит корректные `payment_subject` и `vat_code`.

## Админ-панель и рассылки

- [ ] `/admin` открывает меню, в логах присутствует `ADMIN-AUDIT: action=menu_open`.
- [ ] Команды `/premiumstatus` и `/grantpremium` работают и логируют результат в `ADMIN-STATUS`/`ADMIN-GRANT`.
- [ ] Тестовая рассылка на малую аудиторию проходит без ошибок (`ADMIN-BROADCAST-DONE`).
- [ ] Выход из админ-режима при `/start` очищает состояние (нет подвисших запросов).

## Продакшн-проверки после выката

- [ ] `systemctl status chatbotchef` и `journalctl -u chatbotchef -b` без критических ошибок.
- [ ] Снята метрика `ADMIN-STATS` — значения не выглядят аномальными.
- [ ] Скрипт бэкапов создал свежий файл в `/root/data/backup`.
- [ ] CHANGELOG обновлён и содержит список изменений и точки контроля.
